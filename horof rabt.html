<!doctype html>
<html lang="fa" dir="rtl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>حروف ربط</title>
  <style>
    :root{ --bg: #FFF8F0; --card:#ffffff; --accent:#FF6B6B; --accent2:#FFD166; --text:#222; --muted:#666}
    *{box-sizing:border-box;font-family: 'Tahoma','Segoe UI','Arial',sans-serif}
    body{margin:0;background:linear-gradient(180deg,#C8F7DC 0%, #FFF8F0 100%);color:var(--text);min-height:100vh;display:flex;align-items:center;justify-content:center;padding:20px}
    .app{width:100%;max-width:900px}
    header{display:flex;align-items:center;justify-content:space-between;margin-bottom:14px}
    .title{display:flex;align-items:center;gap:12px}
    .logo{width:64px;height:64px;border-radius:14px;background:linear-gradient(135deg,var(--accent),var(--accent2));display:flex;align-items:center;justify-content:center;color:white;font-weight:700;font-size:20px;box-shadow:0 6px 18px rgba(0,0,0,0.12)}
    h1{margin:0;font-size:22px}
    .meta{font-size:12px;color:var(--muted)}

    .card{background:var(--card);border-radius:16px;padding:18px;box-shadow:0 10px 30px rgba(0,0,0,0.08)}
    .question-area{display:flex;gap:18px;align-items:flex-start}
    .q-left{flex:1}
    .q-text{font-size:18px;margin-bottom:12px}
    .options{display:grid;grid-template-columns:repeat(2,1fr);gap:10px}
    button.opt{background:#F7FAFF;border:2px solid transparent;padding:10px;border-radius:10px;font-size:16px;cursor:pointer;transition:all .18s;box-shadow:0 6px 12px rgba(0,0,0,0.04)}
    button.opt:hover{transform:translateY(-3px)}
    button.opt:focus{outline:3px solid rgba(34,34,34,0.08)}

    .progress{height:12px;background:#eee;border-radius:12px;overflow:hidden;margin-bottom:12px}
    .progress > i{display:block;height:100%;background:linear-gradient(90deg,var(--accent),var(--accent2));width:0%}

    .footer{display:flex;justify-content:space-between;align-items:center;margin-top:12px}
    .feedback{min-height:28px;font-weight:700}
    .controls{display:flex;gap:8px}
    .btn{background:var(--accent);color:#fff;border:none;padding:10px 14px;border-radius:10px;cursor:pointer}
    .btn.secondary{background:#e6e6e6;color:#333}

    .overlay{position:fixed;inset:0;display:flex;align-items:center;justify-content:center;background:rgba(0,0,0,0.28);visibility:hidden;opacity:0;transition:all .18s}
    .overlay.show{visibility:visible;opacity:1}
    .popup{background:var(--card);padding:20px;border-radius:14px;min-width:260px;text-align:center}

    .result{padding:18px;text-align:center}
    .badge{display:inline-block;padding:8px 12px;border-radius:12px;font-weight:700}

    footer.pagefoot{margin-top:12px;text-align:center;font-size:13px;color:var(--muted)}

    /* playful shapes */
    .confetti{position:absolute;pointer-events:none;opacity:0.08}
    @media (max-width:600px){.options{grid-template-columns:1fr}.q-text{font-size:16px}}
  </style>
</head>
<body>
  <div class="app">
    <header>
      <div class="title">
        <div class="logo">حرب</div>
        <div>
          <h1>حروف ربط</h1>
          <div class="meta">بازی آموزشی برای دانش‌آموزان پایه پنجم</div>
        </div>
      </div>
      <div class="meta">Designed by Badr</div>
    </header>

    <main class="card" role="main">
      <div class="progress" aria-hidden><i id="bar"></i></div>

      <div id="stage">
        <div class="question-area">
          <div class="q-left">
            <div class="q-text" id="qtext">بارگذاری سوال...</div>
            <div class="options" id="options"></div>
          </div>
          <div style="width:220px;text-align:center">
            <img src="data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' width='220' height='160'><rect rx='16' width='100%' height='100%' fill='%23FFEDD5'/><text x='50%' y='50%' dominant-baseline='middle' text-anchor='middle' font-family='Tahoma' font-size='18' fill='%23333'>یادگیری با بازی</text></svg>" alt="بازی" style="width:100%;border-radius:12px;box-shadow:0 8px 20px rgba(0,0,0,0.06)"/>
            <div style="margin-top:10px;font-size:13px;color:var(--muted)">سوال <span id="num">0</span> از 20</div>
            <div style="margin-top:8px;font-size:13px;color:var(--muted)">امتیاز: <span id="score">0</span></div>
          </div>
        </div>

        <div class="footer">
          <div class="feedback" id="feedback">برای شروع یک گزینه را انتخاب کن</div>
          <div class="controls">
            <button class="btn secondary" id="prevBtn" disabled>قبلی</button>
            <button class="btn" id="skipBtn">رد کردن</button>
          </div>
        </div>
      </div>

      <div id="result" style="display:none" class="result">
        <h2>نتیجهٔ بازی</h2>
        <div style="margin:12px 0">نمرهٔ شما: <span id="finalScore" style="font-weight:800"></span> از 20</div>
        <div id="rating" class="badge"></div>
        <div id="comment" style="margin-top:10px;color:var(--muted)"></div>
        <div style="margin-top:14px"><button class="btn" id="retry">تلاش دوباره</button></div>
      </div>

    </main>

    <footer class="pagefoot">© حروف ربط — Designed by Badr</footer>
  </div>

  <div class="overlay" id="overlay"><div class="popup" id="popup">پیام</div></div>

  <script>
    const questions = [
      {q: 'من کتابم را تمام کردم … برای مادرم ماجرا را تعریف کردم.', opts:['چون','ولی','سپس','اگر'], ans:2},
      {q: 'امروز می‌خواستم به پارک بروم … هوا ناگهان بارانی شد.', opts:['تا','اما','چون','که'], ans:1},
      {q: 'باید تکالیفم را انجام دهم … فردا معلم آن‌ها را بررسی می‌کند.', opts:['زیرا','ولی','اگر','یا'], ans:0},
      {q: 'علی به موقع از خواب بیدار شد … به اتوبوس مدرسه برسد.', opts:['زیرا','تا','اگرچه','ولی'], ans:1},
      {q: 'من در خانه ماندم … حالم کمی خوب نبود.', opts:['چون‌که','ولی','تا','پس'], ans:0},
      {q: 'به مدرسه رفتم … دوستم آن روز غایب بود.', opts:['زیرا','ولی','تا','چون'], ans:1},
      {q: 'من درس می‌خوانم … می‌خواهم در آینده پزشک شوم.', opts:['چون','تا','اما','و'], ans:1},
      {q: 'پدرم خسته بود … با ما به خرید آمد.', opts:['اگرچه','ولی','زیرا','یا'], ans:0},
      {q: 'معلم از من تعریف کرد … پاسخ درست را گفته بودم.', opts:['زیرا','تا','اما','اگر'], ans:0},
      {q: 'ما به باغ رفتیم … از هوای پاک لذت بردیم.', opts:['تا','و','زیرا','اگرچه'], ans:1},
      {q: '… زنگ مدرسه خورد، دانش‌آموزان با شادی از کلاس بیرون دویدند.', opts:['زیرا','وقتی‌که','تا','اگر'], ans:1},
      {q: 'کتابم را برداشتم … برای امتحان آماده شوم.', opts:['اگر','چون','تا','ولی'], ans:2},
      {q: 'من می‌خواستم تلویزیون تماشا کنم … برق رفت.', opts:['چون','ولی','زیرا','اگرچه'], ans:1},
      {q: 'دیر از خواب بیدار شدم … مجبور شدم با عجله صبحانه بخورم.', opts:['چون','بنابراین','تا','و'], ans:1},
      {q: 'مادر ظرف‌ها را شست … من اتاقم را مرتب می‌کردم.', opts:['در حالی‌که','ولی','زیرا','تا'], ans:0},
      {q: '… مسیر طولانی بود، همه با شور و شوق پیاده‌روی کردند.', opts:['اگرچه','زیرا','تا','ولی'], ans:0},
      {q: 'به دوستش کمک کرد … می‌خواست مهربان باشد.', opts:['چون','تا','و','ولی'], ans:0},
      {q: 'در مسابقه شرکت کرد … توانایی خودش را نشان دهد.', opts:['زیرا','تا','ولی','اگرچه'], ans:1},
      {q: 'ما به پارک رفتیم … در آن‌جا کسی را نمی‌شناختیم.', opts:['ولی','زیرا','چون','تا'], ans:0},
      {q: 'سخت تمرین کردم … در مسابقه برنده شدم.', opts:['زیرا','پس','تا','اما'], ans:1}
    ];

    const total = questions.length;
    let idx = 0; let score = 0; let answered = 0;

    const qtext = document.getElementById('qtext');
    const optionsDiv = document.getElementById('options');
    const num = document.getElementById('num');
    const scoreEl = document.getElementById('score');
    const bar = document.getElementById('bar');
    const feedback = document.getElementById('feedback');
    const overlay = document.getElementById('overlay');
    const popup = document.getElementById('popup');
    const prevBtn = document.getElementById('prevBtn');
    const skipBtn = document.getElementById('skipBtn');

    function render(){
      const item = questions[idx];
      qtext.textContent = item.q;
      optionsDiv.innerHTML = '';
      item.opts.forEach((o,i)=>{
        const b = document.createElement('button');
        b.className='opt'; b.innerText = o; b.setAttribute('data-i',i);
        b.onclick = onSelect;
        optionsDiv.appendChild(b);
      });
      num.textContent = (idx+1);
      scoreEl.textContent = score;
      bar.style.width = ( (idx)/total * 100) + '%';
      prevBtn.disabled = idx===0;
      feedback.textContent = 'یکی از گزینه‌ها را انتخاب کن';
    }

    function showOverlay(msg){ popup.innerText = msg; overlay.classList.add('show'); }
    function hideOverlay(){ overlay.classList.remove('show'); }

    function onSelect(e){
      const chosen = Number(e.currentTarget.getAttribute('data-i'));
      const correct = questions[idx].ans;
      answered++;
      if(chosen===correct){
        score++;
        feedback.textContent = '✅ پاسخ درست!';
        // small delay then next
        setTimeout(()=>{ nextQuestion(); },700);
      } else {
        // wrong: show "دقت کن" then auto next
        feedback.textContent = '❌ دقت کن';
        // briefly highlight correct option
        const opts = Array.from(document.querySelectorAll('.opt'));
        opts.forEach(btn=>{
          btn.disabled=true;
          if(Number(btn.getAttribute('data-i'))===correct){
            btn.style.border='2px solid #18A558';
          }
        });
        setTimeout(()=>{ nextQuestion(); },1000);
      }
      scoreEl.textContent = score;
    }

    function nextQuestion(){
      idx++;
      if(idx>=total){ showResult(); return; }
      render();
    }

    prevBtn.addEventListener('click', ()=>{
      if(idx>0){ idx--; render(); }
    });

    skipBtn.addEventListener('click', ()=>{ nextQuestion(); });

    function showResult(){
      document.getElementById('stage').style.display='none';
      const res = document.getElementById('result');
      res.style.display='block';
      document.getElementById('finalScore').innerText = score;
      // qualitative rating
      let rating=''; let comment='';
      if(score>=18){ rating='خیلی خوب'; comment='آفرین! عملکرد شما عالی بود.' }
      else if(score>=14){ rating='خوب'; comment='خوب است؛ با کمی تمرین بهتر می‌شوی.' }
      else if(score>=10){ rating='قابل قبول'; comment='قابل قبول. تمرین بیشتر کمک می‌کند.' }
      else { rating='نیاز به تلاش'; comment='نگران نباش؛ کمی تمرین و تکرار خیلی کمک می‌کند.' }
      document.getElementById('rating').innerText = rating;
      document.getElementById('comment').innerText = comment;
    }

    document.getElementById('retry').addEventListener('click', ()=>{
      idx=0; score=0; answered=0; document.getElementById('stage').style.display='block'; document.getElementById('result').style.display='none'; render();
    });

    // start
    render();

    // accessibility: keyboard select 1-4
    window.addEventListener('keydown', (e)=>{
      if(document.getElementById('stage').style.display==='none') return;
      if(e.key>='1' && e.key<='4'){
        const i = Number(e.key)-1;
        const btn = document.querySelector('.opt[data-i="'+i+'"]');
        if(btn) btn.click();
      }
    });

  </script>
</body>
</html>
